<!DOCTYPE html>
<html lang="it">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="Contatti - MechFinder, trova il meccanico piÃ¹ adatto a te">
        <meta name="keywords" content="meccanici, contatti, assistenza, riparazioni auto, officina">
        <meta name="author" content="MechFinder">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <link rel="stylesheet" href="/css/style.css">
        <title>Contatti - MechFinder</title>
      </head>
<body>
<%- include('../common/header') %>
<main>
  <div class="container mb-5">
    <div class="row">
      <div class="col-12">
        <div class="dashboard-welcome my-4">
          <h1>Benvenuto nella tua Dashboard, <%= user.nome %></h1>
          <p class="lead">Da qui puoi gestire le tue riparazioni, i tuoi veicoli e visualizzare le tue statistiche.</p>
        </div>
      </div>
    </div>

    <!-- Statistiche -->
    <div class="row mb-4">
      <div class="col-12">
        <h3 class="section-title">Le tue statistiche</h3>
      </div>
      <div class="col-md-3 col-sm-6 mb-4">
        <div class="card text-center h-100">
          <div class="card-body">
            <div class="display-4 fw-bold text-primary"><%= stats ? stats.totalRiparazioni : 0 %></div>
            <h5 class="card-title">Riparazioni Totali</h5>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6 mb-4">
        <div class="card text-center h-100">
          <div class="card-body">
            <div class="display-4 fw-bold text-warning"><%= stats ? stats.riparazioniAttive : 0 %></div>
            <h5 class="card-title">Riparazioni Attive</h5>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6 mb-4">
        <div class="card text-center h-100">
          <div class="card-body">
            <div class="display-4 fw-bold text-success"><%= stats ? stats.riparazioniCompletate : 0 %></div>
            <h5 class="card-title">Riparazioni Completate</h5>
          </div>
        </div>
      </div>
      <div class="col-md-3 col-sm-6 mb-4">
        <div class="card text-center h-100">
          <div class="card-body">
            <div class="display-4 fw-bold text-info"><%= stats ? stats.totalVeicoli : 0 %></div>
            <h5 class="card-title">I Tuoi Veicoli</h5>
          </div>
        </div>
      </div>
    </div>

    <!-- Riparazioni Recenti -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="section-title m-0">Riparazioni Recenti</h3>
          <a href="/cliente/riparazioni" class="btn btn-sm btn-outline-primary">Vedi tutte</a>
        </div>
        
        <% if (riparazioni && riparazioni.length > 0) { %>
          <div class="table-responsive">
            <table class="table table-hover">
              <thead class="table-light">
                <tr>
                  <th>ID</th>
                  <th>Meccanico</th>
                  <th>Descrizione</th>
                  <th>Stato</th>
                  <th>Data Richiesta</th>
                  <th>Azioni</th>
                </tr>
              </thead>
              <tbody>
                <% riparazioni.slice(0, 5).forEach(riparazione => { %>
                  <tr>
                    <td><%= riparazione.id %></td>
                    <td><%= riparazione.meccanico_id %></td>
                    <td><%= riparazione.descrizione.substring(0, 50) %><%= riparazione.descrizione.length > 50 ? '...' : '' %></td>
                    <td>
                      <span class="badge <%= riparazione.stato === 'completata' ? 'bg-success' : (riparazione.stato === 'in_corso' ? 'bg-primary' : (riparazione.stato === 'rifiutata' ? 'bg-danger' : 'bg-warning')) %>">
                        <%= riparazione.stato %>
                      </span>
                    </td>
                    <td><%= new Date(riparazione.data_richiesta).toLocaleDateString() %></td>
                    <td>
                      <a href="/cliente/riparazioni/<%= riparazione.id %>" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-eye"></i> Dettagli
                      </a>
                    </td>
                  </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
        <% } else { %>
          <div class="alert alert-info">
            Non hai ancora nessuna riparazione. <a href="/meccanici">Cerca un meccanico</a> per richiederne una.
          </div>
        <% } %>
      </div>
    </div>

    <!-- I Tuoi Veicoli -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="section-title m-0">I Tuoi Veicoli</h3>
          <a href="/cliente/veicoli" class="btn btn-sm btn-outline-primary">Gestisci veicoli</a>
        </div>
        
        <div class="row">
          <% if (veicoli && veicoli.length > 0) { %>
            <% veicoli.slice(0, 4).forEach(veicolo => { %>
              <div class="col-md-3 col-sm-6 mb-4">
                <div class="vehicle-card">
                  <div class="vehicle-card-header">
                    <div class="vehicle-icon">
                      <i class="fas <%= veicolo.tipo === 'auto' ? 'fa-car' : (veicolo.tipo === 'moto' ? 'fa-motorcycle' : 'fa-truck') %>"></i>
                    </div>
                    <span class="vehicle-type"><%= veicolo.tipo %></span>
                  </div>
                  <div class="vehicle-card-body">
                    <h4><%= veicolo.marca %> <%= veicolo.modello %></h4>
                    <div class="vehicle-specs">
                      <div class="spec-item"><i class="fas fa-calendar-alt"></i> <%= veicolo.anno %></div>
                      <% if (veicolo.targa) { %>
                        <div class="spec-item"><i class="fas fa-id-card"></i> <%= veicolo.targa %></div>
                      <% } %>
                    </div>
                  </div>
                </div>
              </div>
            <% }); %>
          <% } else { %>
            <div class="col-12">
              <div class="alert alert-info">
                Non hai ancora registrato nessun veicolo. <a href="/cliente/veicoli">Aggiungi un veicolo</a> per iniziare.
              </div>
            </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</main>



<%- include('../common/footer') %>
<%- include('../common/modals') %>
<%- include('../common/scripts') %>
</body>
</html>